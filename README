                               C o C o S
                               
                    Continuous Compliance Service


   * Package contents *

README            This file

include/          fake headers for standard libraries
pycparser/        C99 parser
pycparserext/     GNU C parser

cocos.py          CoCoS command-line front end (single file analysis)
config            git configuration to allow usage of diffsitter (optional usage)
diffsitter        semantic diff tool (optional usage)
extractlines.py   read semantic diff and convert into file-to-line map
file_line_map.py  Map from files to changed lines
file_func_map.py  Map from files to changed functions
run.py            Macro to run cocos.py on multiple files (component analysis)

copyrepo.sh       creates copies of the given commit(s) to be analysed
run.sh            Main script (performs full run)

  * Dependencies *

- Python 3
- Git
- (optional) GraphViz


  * Usage *

1) Certify that all scripts have execution permissions (+x):

   chmod +x run.sh copyrepos.sh run.py extractlines.py cocos.py diffsitter


2) (optional) To use diffsitter, add the content from config file 
   to your git configuration files (<path/to/each/repo>/.git/config)


3) Execute run.sh on the form:
   
   ./run.sh [-t DIFF_TOOL] [-D] [-n NEW_TAG] [-I INCLUDE_PATHS] [-m MACRO_DEFS] 
            [-M MACRO_FILE] [-d VERBOSITY_LEVEL] [-r REPOS_DIR] <commit1> [<commit2>]

where
   -t TOOL             specifies the semantic diff tool used (diffsitter or cocos-only)
                       (default: cocos-only)
   -D                  debug mode
   -n NEWTAG           activates .changelog creation for NEWTAG release number
   -I INCLUDEPATHS     comma-separated list of include paths (for preprocessing)
   -m MACRO_DEFS       comma-separated list of user defined macros (for preprocessing)
   -M MACRO_FILE       file containing user defined macros (for preprocessing)
   -d VERBOSITY_LEVEL  define level of log verbosity from 1 (less verbose) to 4 (full log)
                       (default: 4)
   -r REPOS_DIR        directory to search for git repositories (default: CoCoS/repos/)
   <commit1>        old commit to compare
   <commit2>        new commit to compare (optional). If none is provided, comparison 
                    occurs between <commit1> and working directory (default)

Have in mind that, if the repositories are considerably big, you might want to save
the output in a separate file (use > output.txt at the end of the command)


4) (optional, for single file test) execute cocos.py (from CoCoS folder) on the form:

  cocos.py [-h] [-o OLD] [-l LINES] [-f FUNCTIONS] [--caller-depth CALLER_DEPTH] 
           [--callee-depth CALLEE_DEPTH] [-A] [-g GRAPHIC] [-n NEW_TAG] [-I INCLUDE] 
           [--macros MACROS] [-M MACRO_FILE] [-d VERBOSITY] [-v]
           input

where
  -h                           prints help message and exit
  -o OLD                       specifies old version of the file to be analysed
  -l LINES                     Comma-separated list of changed lines
  -f FUNCTIONS                 Comma-separated list of changed functions
  --caller-depth CALLER_DEPTH  Depth of caller tree for retesting 
                               (use -1 for max depth)
  --callee-depth CALLEE_DEPTH  Depth of callee tree for retesting 
                               (use -1 for max depth)
  -A                           show file AST and exit (skip analysis)
  -g GRAPHIC                   save function call graph in GRAPHIC.dot file
  -n NEW_TAG                   save change log for new release tag
  -I INCLUDEPATHS              Comma-separated list of include paths
  --macros MACROS              comma-separated list of user defined macros (for preprocessing)
  -M MACRO_FILE                file containing user defined macros (for preprocessing)
  -d VERBOSITY                 set verbosity level from 1 (less verbose) to [default] 4 (full log)
  -v, --version                show program's version number and exit

5) (optional) install GraphViz to visualise .dot files generated by cocos.py

   sudo apt install graphviz (For Ubuntu/Debian users)
   dot -Tpng GRAPHIC.dot -o FILENAME.png