                               C o C o S
                               
                    Continuous Compliance Service


   * Package contents *

README            This file

include/          fake headers for standard libraries
pycparser/        C99 parser
pycparserext/     GNU C parser

cocos.py          CoCoS command-line front end (single file analysis)
config            git configuration to allow usage of diffsitter (optional usage)
diffsitter        semantic diff tool (optional usage)
extractlines.py   read semantic diff and convert into file-to-line map
file_line_map.py  Map from files to changed lines
file_func_map.py  Map from files to changed functions
run.py            Macro to run cocos.py on multiple files (component analysis)

copyrepo.sh       creates copies of the given commit(s) to be analysed
run.sh            Main script (performs full run)


  * Usage *

1) Move the CoCoS folder to the root of the git repository:

   mv CoCoS/ <path/to/repository>

2) Change directory to CoCoS

   cd <path/to/repository>/CoCoS


3) Certify that all scripts have execution permissions (+x):

   chmod +x run.sh copyrepo.sh run.py extractlines.py cocos.py diffsitter


4) Move shell scripts (copyrepo.sh and run.sh) to the root of git repository:

   mv copyrepo.sh run.sh ../


5) (optional) To use diffsitter, add the content from config file 
   to your git configuration (<path/to/repository>/.git/config)


6) Change directory to git root

   cd ..


7) Execute run.sh on the form:
   
   ./run.sh [-t TOOL] [-D] [-n NEWTAG] [-I INCLUDEPATHS] <commit1> [<commit2>]

where
   -t TOOL          specifies the semantic diff tool used (diffsitter or cocos-only)
                    (default: cocos-only)
   -D               debug mode
   -n NEWTAG        activates .changelog creation for NEWTAG release number
   -I INCLUDEPATHS  comma-separated list of include paths (for preprocessing)
   <commit1>        old commit to compare
   <commit2>        new commit to compare (optional). If none is provided, comparison 
                    occurs between <commit1> and working directory (default)

Have in mind that, if the repository is considerably big, you might want to save
the output in a separate file (use > output.txt at the end of the command)


8) (optional, for single file test) execute cocos.py (from CoCoS folder) on the form:

  cocos.py [-h] [-o OLD] [-l LINES] [-f FUNCTIONS] 
           [--caller-depth CALLER_DEPTH] [--callee-depth CALLEE_DEPTH] 
           [-A] [-g GRAPHIC] [-n NEW_TAG] [-I INCLUDEPATHS] input

where
  -h                           prints help message and exit
  -o OLD                       specifies old version of the file to be analysed
  -l LINES                     Comma-separated list of changed lines
  -f FUNCTIONS                 Comma-separated list of changed functions
  --caller-depth CALLER_DEPTH  Depth of caller tree for retesting 
                               (use -1 for max depth)
  --callee-depth CALLEE_DEPTH  Depth of callee tree for retesting 
                               (use -1 for max depth)
  -A                           show file AST and exit (skip analysis)
  -g GRAPHIC                   save function call graph in GRAPHIC.dot file
  -n NEW_TAG                   save change log for new release tag
  -I INCLUDEPATHS              Comma-separated list of include paths

9) (optional) install GraphViz to visualise .dot files generated by cocos.py

   sudo apt install graphviz (For Ubuntu/Debian users)
   dot -Tpng GRAPHIC.dot -o FILENAME.png